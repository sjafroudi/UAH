<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Display a map on a webpage</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.js"></script>

  <style>
  body { margin: 0; padding: 0; }
  #map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>

</head>

<body>
  <div id="map"></div>
  <script>

  mapboxgl.accessToken = 'pk.eyJ1Ijoic2phZnJvdWRpIiwiYSI6ImNra2VibWp0azB5azUyb256dHlpaHRtNDQifQ.LBpfWLTC701RZ51wpR_E9A';
  var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/sjafroudi/ckkebwmd4094i17rvfpitb0pz', // style URL
    center: [-71.0929799079895,42.34583405051044], // starting position [lng, lat] 30.3609, 59.9311
    zoom: 9 // starting zoom
  });

  // DATA: UAH Polygons
  map.on('load', function () {
    map.addSource('data', {
      type: 'geojson',
      data: 'https://raw.githubusercontent.com/sjafroudi/UAH/main/data.geojson'
    });

    map.addLayer({
      'id': 'Site',
      'type': 'fill',
      'source': 'data',
      'paint': {
        'fill-color': '#888888',
        'fill-outline-color': '#6a0dad',
        'fill-opacity': 0.4
      }
    });

    map.addLayer({
      'id': 'Boundary',
      'type': 'line',
      'source': 'data',
      'paint': {
        'line-color': '#888',
        'line-width': 3
      }
    });
  });

  // DATA: Dachas (polyons within 120 km radius of Saint Petersburg)
  map.on('load', function () {
    map.addSource('dachas', {
      type: 'geojson',
      data: 'https://raw.githubusercontent.com/sjafroudi/UAH/main/DACHAS_DEGREES.geojson'
    });

    map.addLayer({
      'id': 'Dachas',
      'type': 'fill',
      'source': 'dachas',
      'paint': {
        'fill-color': '#9b9ba0',
        'fill-outline-color': '#9b9ba0',
        'fill-opacity': 0.4
      }
    });

    map.addLayer({
      'id': 'Dachas_Boundary',
      'type': 'line',
      'source': 'dachas',
      'paint': {
        'line-color': '#959ba0',
        'line-width': 1
      }
    });
  });

  // DATA: Dachas St Petersburg Buffer Zone
  map.on('load', function () {
    map.addSource('dachasRadius', {
      type: 'geojson',
      data: 'https://raw.githubusercontent.com/sjafroudi/UAH/main/BUFFER.geojson'
    });

    map.addLayer({
      'id': 'DachasRadius',
      'type': 'fill',
      'source': 'dachasRadius',
      'paint': {
        'fill-color': '#9b9ba0',
        'fill-outline-color': '#9b9ba0',
        'fill-opacity': 0.05
      }
    });

    map.addLayer({
      'id': 'DachasRadiusBoundary',
      'type': 'line',
      'source': 'dachasRadius',
      'paint': {
        'line-color': '#959ba0',
        'line-width': 0.8
      }
    });
  });

  // DATA: Points
  map.on('load', function () {
    map.loadImage('https://raw.githubusercontent.com/sjafroudi/UAH/main/marker-stroked15.png', function (error, image){
      if (error) throw error;
      map.addImage('icon', image);
      map.addSource('points', {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/sjafroudi/UAH/main/points.geojson'
      });

      map.addLayer({
        'id': 'Points',
        'type': 'symbol',
        'source': 'points',
        'layout': {
          'icon-allow-overlap': true,
          'icon-image': 'icon',
          'icon-size': 0.1
        },
        'paint': {
          'icon-color': '#c0c0c0'
        }
      });

      var popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
      });

      map.on('mouseenter', 'Points', function(e) {
        map.getCanvas().style.cursor = 'pointer';
        popup.setLngLat(e.features[0].geometry.coordinates);
        popup.setHTML('<h3>' + e.features[0].properties.site + '</h3>');
        popup.addTo(map);
      });

      map.on('mouseleave', 'Points', function() {
        map.getCanvas().style.cursor = '';
        popup.remove();
      });

      map.setLayerZoomRange('Points', 0, 24);

    });
  });

</script>

</body>
</html>
